<?php

namespace App\SearchTransformers;

use Illuminate\Support\Str;
use Statamic\Statamic;

class Content
{
    protected $stopwords = [
        'en' => [
            'a',
            'about',
            'above',
            'after',
            'again',
            'against',
            'all',
            'am',
            'an',
            'and',
            'any',
            'are',
            'arent',
            'as',
            'at',
            'be',
            'because',
            'been',
            'before',
            'being',
            'below',
            'between',
            'both',
            'but',
            'by',
            'cant',
            'cannot',
            'could',
            'couldnt',
            'did',
            'didnt',
            'do',
            'does',
            'doesnt',
            'doing',
            'dont',
            'down',
            'during',
            'each',
            'few',
            'for',
            'from',
            'further',
            'had',
            'hadnt',
            'has',
            'hasnt',
            'have',
            'havent',
            'having',
            'he',
            'hed',
            'hell',
            'hes',
            'her',
            'here',
            'heres',
            'hers',
            'herself',
            'him',
            'himself',
            'his',
            'how',
            'hows',
            'i',
            'id',
            'ill',
            "i'm",
            'ive',
            'if',
            'in',
            'into',
            'is',
            'isnt',
            'it',
            'its',
            'its',
            'itself',
            'lets',
            'me',
            'more',
            'most',
            'mustnt',
            'my',
            'myself',
            'no',
            'nor',
            'not',
            'of',
            'off',
            'on',
            'once',
            'only',
            'or',
            'other',
            'ought',
            'our',
            'ours',
            'ourselves',
            'out',
            'over',
            'own',
            'same',
            'shant',
            'she',
            'shed',
            'shell',
            'shes',
            'should',
            'shouldnt',
            'so',
            'some',
            'such',
            'than',
            'that',
            'thats',
            'the',
            'their',
            'theirs',
            'them',
            'themselves',
            'then',
            'there',
            'theres',
            'these',
            'they',
            'theyd',
            'theyll',
            'theyre',
            'theyve',
            'this',
            'those',
            'through',
            'to',
            'too',
            'under',
            'until',
            'up',
            'very',
            'was',
            'wasnt',
            'we',
            'wed',
            'well',
            'were',
            'weve',
            'were',
            'werent',
            'what',
            'whats',
            'when',
            'whens',
            'where',
            'wheres',
            'which',
            'while',
            'who',
            'whos',
            'whom',
            'why',
            'whys',
            'with',
            'wont',
            'would',
            'wouldnt',
            'you',
            'youd',
            'youll',
            'youre',
            'youve',
            'your',
            'yours',
            'yourself',
            'yourselves',
        ],
        'de' => [
            'aber',
            'als',
            'am',
            'an',
            'auch',
            'auf',
            'aus',
            'bei',
            'bin',
            'bis',
            'bist',
            'da',
            'dadurch',
            'daher',
            'darum',
            'das',
            'daß',
            'dass',
            'dein',
            'deine',
            'dem',
            'den',
            'der',
            'des',
            'dessen',
            'deshalb',
            'die',
            'dies',
            'dieser',
            'dieses',
            'doch',
            'dort',
            'du',
            'durch',
            'ein',
            'eine',
            'einem',
            'einen',
            'einer',
            'eines',
            'er',
            'es',
            'euer',
            'eure',
            'für',
            'hatte',
            'hatten',
            'hattest',
            'hattet',
            'hier',
            'hinter',
            'ich',
            'ihr',
            'ihre',
            'im',
            'in',
            'ist',
            'ja',
            'jede',
            'jedem',
            'jeden',
            'jeder',
            'jedes',
            'jener',
            'jenes',
            'jetzt',
            'kann',
            'kannst',
            'können',
            'könnt',
            'machen',
            'mein',
            'meine',
            'mit',
            'muß',
            'mußt',
            'musst',
            'müssen',
            'müßt',
            'nach',
            'nachdem',
            'nein',
            'nicht',
            'nun',
            'oder',
            'seid',
            'sein',
            'seine',
            'sich',
            'sie',
            'sind',
            'soll',
            'sollen',
            'sollst',
            'sollt',
            'sonst',
            'soweit',
            'sowie',
            'und',
            'unser',
            'unsere',
            'unter',
            'vom',
            'von',
            'vor',
            'wann',
            'warum',
            'was',
            'weiter',
            'weitere',
            'wenn',
            'wer',
            'werde',
            'werden',
            'werdet',
            'weshalb',
            'wie',
            'wieder',
            'wieso',
            'wir',
            'wird',
            'wirst',
            'wo',
            'woher',
            'wohin',
            'zu',
            'zum',
            'zur',
            'über',
        ],
        'it' => [
            'a',
            'adesso',
            'ai',
            'al',
            'alla',
            'allo',
            'allora',
            'altre',
            'altri',
            'altro',
            'anche',
            'ancora',
            'avere',
            'aveva',
            'avevano',
            'ben',
            'buono',
            'che',
            'chi',
            'cinque',
            'comprare',
            'con',
            'consecutivi',
            'consecutivo',
            'cosa',
            'cui',
            'da',
            'del',
            'della',
            'dello',
            'dentro',
            'deve',
            'devo',
            'di',
            'doppio',
            'due',
            'e',
            'ecco',
            'fare',
            'fine',
            'fino',
            'fra',
            'gente',
            'giu',
            'ha',
            'hai',
            'hanno',
            'ho',
            'il',
            'indietro',
            'invece',
            'io',
            'la',
            'lavoro',
            'le',
            'lei',
            'lo',
            'loro',
            'lui',
            'lungo',
            'ma',
            'me',
            'meglio',
            'molta',
            'molti',
            'molto',
            'nei',
            'nella',
            'no',
            'noi',
            'nome',
            'nostro',
            'nove',
            'nuovi',
            'nuovo',
            'o',
            'oltre',
            'ora',
            'otto',
            'peggio',
            'pero',
            'persone',
            'piu',
            'poco',
            'primo',
            'promesso',
            'qua',
            'quarto',
            'quasi',
            'quattro',
            'quello',
            'questo',
            'qui',
            'quindi',
            'quinto',
            'rispetto',
            'sara',
            'secondo',
            'sei',
            'sembra',
            'sembrava',
            'senza',
            'sette',
            'sia',
            'siamo',
            'siete',
            'solo',
            'sono',
            'sopra',
            'soprattutto',
            'sotto',
            'stati',
            'stato',
            'stesso',
            'su',
            'subito',
            'sul',
            'sulla',
            'tanto',
            'te',
            'tempo',
            'terzo',
            'tra',
            'tre',
            'triplo',
            'ultimo',
            'un',
            'una',
            'uno',
            'va',
            'vai',
            'voi',
            'volte',
            'vostro',
        ],
        'fr' => [
            'alors',
            'au',
            'aucuns',
            'aussi',
            'autre',
            'avant',
            'avec',
            'avoir',
            'bon',
            'car',
            'ce',
            'cela',
            'ces',
            'ceux',
            'chaque',
            'ci',
            'comme',
            'comment',
            'dans',
            'des',
            'du',
            'dedans',
            'dehors',
            'depuis',
            'devrait',
            'doit',
            'donc',
            'dos',
            'début',
            'elle',
            'elles',
            'en',
            'encore',
            'essai',
            'est',
            'et',
            'eu',
            'fait',
            'faites',
            'fois',
            'font',
            'hors',
            'ici',
            'il',
            'ils',
            'je',
            'juste',
            'la',
            'le',
            'les',
            'leur',
            'là',
            'ma',
            'maintenant',
            'mais',
            'mes',
            'mien',
            'moins',
            'mon',
            'mot',
            'même',
            'ni',
            'nommés',
            'notre',
            'nous',
            'ou',
            'où',
            'par',
            'parce',
            'pas',
            'peut',
            'peu',
            'plupart',
            'pour',
            'pourquoi',
            'quand',
            'que',
            'quel',
            'quelle',
            'quelles',
            'quels',
            'qui',
            'sa',
            'sans',
            'ses',
            'seulement',
            'si',
            'sien',
            'son',
            'sont',
            'sous',
            'soyez',
            'sujet',
            'sur',
            'ta',
            'tandis',
            'tellement',
            'tels',
            'tes',
            'ton',
            'tous',
            'tout',
            'trop',
            'très',
            'tu',
            'voient',
            'vont',
            'votre',
            'vous',
            'vu',
            'ça',
            'étaient',
            'état',
            'étions',
            'été',
            'être',
        ],
    ];

    public function handle($value, $handle, $entry)
    {
        $locale = $entry->locale();

        $value = implode(' ', [
            $entry->get('title'),
            Statamic::modify($entry->get('legal_text'))->bardText()->fetch(),
            Statamic::modify($entry->get('content'))->bardText()->fetch(),
        ]);
        $value = Str::of($value)
            ->replaceMatches('/https?:\/\/\S+/u', '')
            ->replaceMatches('/[^\p{L}\p{N}\s]/u', '')
            ->explode(' ')
            ->map(fn ($word) => (string) Str::of($word)->lower())
            ->reject(fn ($word) => in_array($word, $this->stopwords[$locale]))
            ->join(' ');
        $value = Str::limit($value, 9200);

        return $value;
    }
}
